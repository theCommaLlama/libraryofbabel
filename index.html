<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Library of Babel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Spectral:wght@400;500;600;700&family=Source+Sans+3:wght@400;500;600&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --bg-deep: #03040d;
            --bg-dusk: #101a34;
            --bg-veil: rgba(10, 21, 43, 0.75);
            --ink: #f4f1e9;
            --ink-soft: rgba(244, 241, 233, 0.72);
            --ink-dim: rgba(244, 241, 233, 0.45);
            --accent-gold: #f6c86e;
            --accent-ember: #ff6f61;
            --accent-cyan: #69e3ff;
            --accent-violet: #8262ff;
            --glass-border: rgba(255, 255, 255, 0.12);
            --shadow-strong: 0 40px 140px rgba(2, 6, 19, 0.85);
            --shadow-soft: 0 24px 60px rgba(4, 9, 27, 0.65);
            --panel-blur: blur(26px);
            --transition: cubic-bezier(0.22, 1, 0.36, 1);
            --animation-state: running;
            --animation-duration-scale: 1.35;
            --bg-animate-duration: 5s;
        }
        @media (prefers-reduced-motion: reduce) {
            :root {
                --animation-state: paused;
                --animation-duration-scale: 2.5;
            }
        }
        body {
            font-family: 'Spectral', 'Georgia', serif;
            background: radial-gradient(circle at 50% 18%, rgba(45, 74, 138, 0.58) 0%, rgba(18, 32, 66, 0.92) 42%, var(--bg-deep) 82%);
            color: var(--ink);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            padding-bottom: 0;
        }
        body::before,
        body::after {
            content: '';
            position: fixed;
            inset: -25%;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            animation-play-state: paused;
        }
        body::before {
            background: radial-gradient(circle, rgba(130, 98, 255, 0.18) 0%, rgba(4, 9, 27, 0) 60%);
            filter: blur(80px);
            animation: bgPulseBefore var(--bg-animate-duration) ease-out forwards;
        }
        body::after {
            background: radial-gradient(circle, rgba(246, 200, 110, 0.12) 0%, rgba(3, 4, 13, 0) 55%);
            filter: blur(120px);
            animation: bgPulseAfter var(--bg-animate-duration) ease-out forwards;
        }
        .background-layers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;

        }
        .background-layers::before {
            content: '';
            position: absolute;
            inset: -35%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.08) 0%, rgba(4, 10, 30, 0.02) 50%, rgba(4, 10, 30, 0.4) 100%);
            filter: blur(40px);
            opacity: 0.35;
        }
        .aurora {
            position: absolute;
            top: -40%;
            left: -40%;
            width: 180%;
            height: 180%;
            filter: blur(90px);
            opacity: 0.28;
            mix-blend-mode: screen;
            animation: auroraBurst var(--bg-animate-duration) ease-out forwards;
        }
        .aurora-1 {
            background: conic-gradient(from 120deg, rgba(246, 200, 110, 0.18), rgba(130, 98, 255, 0.18), rgba(105, 227, 255, 0.2), transparent 340deg);
            animation-delay: 0s;
        }
        .aurora-2 {
            background: conic-gradient(from -40deg, rgba(255, 111, 97, 0.22), rgba(105, 227, 255, 0.16), transparent 320deg);
        }
        .hex-grid {
            position: absolute;
            top: -25%;
            left: -25%;
            width: 150%;
            height: 150%;
            opacity: 0.25;
            background-image:
                radial-gradient(circle at center, rgba(250, 214, 144, 0.12) 0%, rgba(3, 4, 13, 0) 55%),
                repeating-linear-gradient(60deg, rgba(255, 255, 255, 0.04) 0, rgba(255, 255, 255, 0.04) 1px, transparent 1px, transparent 60px),
                repeating-linear-gradient(-60deg, rgba(130, 98, 255, 0.06) 0, rgba(130, 98, 255, 0.06) 1px, transparent 1px, transparent 60px),
                repeating-linear-gradient(0deg, rgba(105, 227, 255, 0.04) 0, rgba(105, 227, 255, 0.04) 1px, transparent 1px, transparent 60px);
            mix-blend-mode: screen;
            animation: gridSweep var(--bg-animate-duration) ease-out forwards;
        }
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            opacity: 0;
            animation: starsFadeIn 3s ease-in forwards;
            animation-delay: 1.5s;
        }
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }
        @keyframes starsFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        header {
            position: sticky;
            top: 0;
            z-index: 6;
            padding: 46px 5vw 26px;
            background: linear-gradient(180deg, rgba(5, 11, 25, 0.88) 0%, rgba(5, 11, 25, 0.54) 60%, rgba(5, 11, 25, 0.18) 100%);
            backdrop-filter: blur(32px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            cursor: pointer;
            max-height: 240px;
            transition: padding 0.55s var(--transition), background 0.55s ease, box-shadow 0.55s ease, border-bottom 0.55s ease, max-height 0.55s var(--transition);

        }
        header .nav-bar,
        header .nav-bar * {
            cursor: auto;
        }
        header.shrunken {
            padding: 6px 5vw 10px;
            background: linear-gradient(180deg, rgba(5, 11, 25, 0.99) 0%, rgba(5, 11, 25, 0.95) 58%, rgba(5, 11, 25, 0.82) 100%);
            box-shadow: 0 26px 90px rgba(2, 6, 19, 0.78);
            max-height: 100px;
        }
        .header-inner {
            max-width: 1280px;
            margin: 0 auto 28px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 24px;
            position: relative;
            transition: margin 0.4s var(--transition), gap 0.4s var(--transition);
        }
        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            align-self: center;
            gap: 16px;
        }
        .header-actions a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            color: var(--ink);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
            transition: transform 0.35s var(--transition), box-shadow 0.35s var(--transition), border-color 0.35s ease;
        }
        .header-actions a::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.12), rgba(105, 227, 255, 0.08));
            opacity: 0;
            transition: opacity 0.35s ease;
            pointer-events: none;
        }
        .header-actions a:hover {
            transform: translateY(-2px) scale(1.01);
            border-color: rgba(246, 200, 110, 0.5);
            box-shadow: 0 12px 24px rgba(8, 14, 32, 0.4);
        }
        .header-actions a:hover::after {
            opacity: 1;
        }
        .header-actions a:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 3px;
        }
        .header-actions svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
            position: relative;
            z-index: 1;
        }
        header.shrunken .header-inner {
            margin-bottom: 0;
            align-items: center;
            gap: 12px;
        }
        header.shrunken .header-actions {
            align-self: center;
            padding-top: 6px;
            margin-top: 0;
        }
        .header-inner::after {
            content: '';
            position: absolute;
            inset: -22%;
            background: radial-gradient(circle at 40% 60%, rgba(246, 200, 110, 0.14), rgba(130, 98, 255, 0.08), transparent 70%);
            filter: blur(40px);
            opacity: 0.6;
            pointer-events: none;
        }
        .header-title-block {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin: 4px;
            position: relative;
            z-index: 1;
            transition: gap 0.35s var(--transition);
            align-items: flex-start;
        }
        header.shrunken .header-title-block {
            gap: 0;
        }
        .library-title {
            font-size: clamp(2.6rem, 4vw, 4.2rem);
            letter-spacing: 0.14em;
            text-transform: uppercase;
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.95), rgba(255, 183, 120, 0.95), rgba(130, 98, 255, 0.92));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 32px rgba(246, 200, 110, 0.25);
            position: relative;
            z-index: 1;
            font-weight: 600;
            transform-origin: left center;
            transition: transform 0.45s var(--transition), letter-spacing 0.45s var(--transition), text-shadow 0.45s ease, font-size 0.45s var(--transition);
            line-height: 1.05;
            cursor: pointer;
        }
        .library-title:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 6px;
        }
        header.shrunken .library-title {
            transform: none;
            font-size: clamp(1.2rem, 2.1vw, 1.55rem);
            letter-spacing: 0.2em;
            text-shadow: 0 0 10px rgba(246, 200, 110, 0.5);
            line-height: 1;
        }
        .library-subtitle {
            max-width: 620px;
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: clamp(1rem, 1.4vw, 1.15rem);
            letter-spacing: 0.05em;
            color: var(--ink-soft);
            line-height: 1.8;
            text-transform: uppercase;
            transition: opacity 0.4s var(--transition), transform 0.4s var(--transition), max-height 0.4s var(--transition);
        }
        header.shrunken .library-subtitle {
            opacity: 0;
            transform: translateY(-20px);
            max-height: 0;
            pointer-events: none;
        }
        .header-location {
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.72rem;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: rgba(239, 242, 250, 0.78);
            opacity: 0;
            transform: translateY(12px);
            transition: opacity 0.35s var(--transition), transform 0.35s var(--transition), letter-spacing 0.35s var(--transition), font-size 0.35s var(--transition);
            max-width: 640px;
            text-align: right;
            white-space: nowrap;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .header-location.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        header.shrunken .header-location.is-visible {
            text-align: left;
            letter-spacing: 0.16em;
            font-size: 0.68rem;
            line-height: 1.15;
            padding-top: 4px;
        }
        .nav-bar {
            max-width: 1280px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;

            border-radius: 24px;
            background: linear-gradient(135deg, rgba(9, 18, 41, 0.9), rgba(8, 22, 49, 0.65));
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-soft);
            backdrop-filter: var(--panel-blur);
            max-height: 320px;
            transition: padding 0.35s var(--transition), max-height 0.35s var(--transition), opacity 0.3s ease, visibility 0s linear 0s;
            visibility: visible;
        }
        header.shrunken .nav-bar {
            max-height: 0;
            opacity: 0;
            padding: 0;
            pointer-events: none;

            border-color: rgba(255, 255, 255, 0);
            box-shadow: none;
            margin-top: 0;
            visibility: hidden;
            transition: padding 0.35s var(--transition), max-height 0.35s var(--transition), opacity 0.3s ease, visibility 0s linear 0.35s;
        }
        .nav-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .nav-section label {
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.75rem;
            letter-spacing: 0.28em;
            text-transform: uppercase;
            color: var(--ink-dim);
        }
        .nav-section input[type="text"],
        .nav-section input[type="number"] {
            width: 100%;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            color: var(--ink);
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.95rem;
            letter-spacing: 0.04em;
            transition: border-color 0.35s ease, box-shadow 0.35s ease, transform 0.35s ease;
            backdrop-filter: var(--panel-blur);
        }
        .nav-section input[type="text"] {
            min-width: 160px;
        }
        .nav-section input[type="number"]::-webkit-outer-spin-button,
        .nav-section input[type="number"]::-webkit-inner-spin-button {
            appearance: none;
            margin: 0;
        }
        .nav-section input[type="number"] {
            appearance: textfield;
        }
        .nav-section input:focus {
            outline: none;
            border-color: rgba(246, 200, 110, 0.85);
            box-shadow: 0 0 0 4px rgba(246, 200, 110, 0.16);
            transform: translateY(-1px);
        }
        .nav-bar button {
            width: 100%;
        }
        button {
            padding: 12px 18px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: linear-gradient(135deg, rgba(246, 200, 110, 0.9), rgba(255, 111, 97, 0.92));
            color: #091229;
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.92rem;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform 0.35s var(--transition), box-shadow 0.35s var(--transition), background 0.35s ease;
            box-shadow: 0 14px 34px rgba(255, 162, 120, 0.28);
            backdrop-filter: var(--panel-blur);
        }
        button:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 24px 52px rgba(255, 151, 107, 0.35);
        }
        button:active {
            transform: translateY(0) scale(0.98);
        }
        button.secondary {
            background: linear-gradient(135deg, rgba(32, 55, 102, 0.88), rgba(18, 32, 73, 0.92));
            color: var(--ink);
            box-shadow: 0 16px 36px rgba(24, 42, 88, 0.35);
        }
        button.random-btn {
            background: linear-gradient(135deg, rgba(130, 98, 255, 0.96), rgba(105, 227, 255, 0.92));
            color: #050b1a;
            box-shadow: 0 18px 40px rgba(109, 184, 255, 0.35);
        }
        .main-content {
            max-width: 1500px;
            margin: 48px auto 0;
            padding: 0 5vw 88px;
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(320px, 1fr);
            gap: 48px;
            align-items: start;
            position: relative;
            z-index: 5;
            flex: 1 0 auto;
        }
        .left-panel {
            min-width: 0;
            perspective: 1400px;
        }
        .page-display {
            background: linear-gradient(130deg, rgba(255, 255, 255, 0.96) 0%, rgba(248, 240, 223, 0.94) 40%, rgba(239, 229, 205, 0.92) 100%);
            color: #1b263b;
            border-radius: 30px;
            padding: 38px 48px 38px;
            box-shadow: var(--shadow-strong);
            position: relative;

            border: 1px solid rgba(26, 44, 80, 0.12);
            animation: none;
            display: flex;
            flex-direction: column;
            transform-style: preserve-3d;
            transition: transform 1.2s var(--transition), box-shadow 0.6s ease;
            transform-origin: center;
        }
        .page-display.is-animating {
            animation: pageFlip 0.6s ease-out;
        }
        .page-display:hover {
            transform: none;
            box-shadow: 0 55px 160px rgba(4, 12, 34, 0.58);
        }
        .page-display::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0.7;
        }
        .page-display::after {
            content: '';
            position: absolute;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.55);
            pointer-events: none;
            mix-blend-mode: screen;
        }
        .nav-page-btn {
            position: absolute;
            top: 24px;
            width: 64px;
            height: 64px;
            padding: 0;
            border: none;
            background: none;
            box-shadow: none;
            color: rgba(55, 42, 28, 0.82);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: none;
            z-index: 5;
            overflow: visible;
            backdrop-filter: none;
            clip-path: polygon(50% 6.25%, 84.375% 25%, 84.375% 75%, 50% 93.75%, 15.625% 75%, 15.625% 25%);
            -webkit-clip-path: polygon(50% 6.25%, 84.375% 25%, 84.375% 75%, 50% 93.75%, 15.625% 75%, 15.625% 25%);
        }
        .nav-page-btn::after {
            content: none;
        }
        .nav-page-btn .nav-icon {
            position: relative;
            width: 58px;
            height: 58px;
            display: block;
            color: inherit;
        }
        .nav-page-btn .hex-frame {
            transition: stroke 0.35s ease;
        }
        .nav-page-btn .glyph {
            transition: filter 0.35s ease, stroke 0.35s ease;
        }
        .nav-page-btn .spark {
            transition: opacity 0.35s ease, transform 0.35s ease;
            opacity: 0.35;
        }
        .nav-page-btn.nav-prev {
            left: 26px;
        }
        .nav-page-btn.nav-next {
            right: 26px;
        }
        .nav-page-btn.is-disabled {
            opacity: 0.35;
            cursor: not-allowed;
            pointer-events: none;
        }
        .nav-page-btn:hover {
            transform: none;
            background: none;
            box-shadow: none;
            color: rgba(120, 55, 35, 0.92);
        }
        .nav-page-btn:hover::after {
            content: none;
        }
        .nav-page-btn:hover .hex-frame {
            stroke: rgba(255, 255, 255, 0.72);
        }
        .nav-page-btn:hover .glyph {
            filter: drop-shadow(0 0 8px rgba(246, 200, 110, 0.7));
            stroke: url(#navHoverGlow);
        }
        .nav-page-btn:hover .spark {
            opacity: 0.95;
            transform: scale(1.2);
        }
        .nav-page-btn:active {
            transform: translateY(1px) scale(0.97);
        }
        .nav-page-btn:disabled {
            opacity: 0.35;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .page-header {
            text-align: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 1px solid rgba(35, 54, 88, 0.18);
            flex: 0 0 auto;
        }
        .page-header h3 {
            font-size: clamp(1.4rem, 2.5vw, 2rem);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #16243d;
        }
        .location-info {
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.95rem;
            letter-spacing: 0.08em;
            color: rgba(21, 35, 62, 0.75);
            line-height: 1.8;
        }
        .page-content {
            font-family: 'Source Sans 3', 'IBM Plex Mono', 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.4;
            color: #1d273c;
            letter-spacing: 0.6px;
            text-align: justify;
            white-space: pre-wrap;
            word-wrap: break-word;
            width: 100%;
            flex: 1 1 auto;
            scroll-behavior: smooth;
            scrollbar-width: auto;
            scrollbar-color: rgba(246, 200, 110, 0.96) rgba(40, 20, 10, 0.28);
            scrollbar-gutter: stable both-edges;
            pointer-events: auto;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            position: relative;
            z-index: 1;
        }
        .page-content::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: -1px;
            height: 1px;
        }
        }
        .page-content::-webkit-scrollbar {
            width: 14px;
            background-color: rgba(40, 20, 10, 0.35);
        }
        .page-content::-webkit-scrollbar-track {
            background: rgba(40, 20, 10, 0.35);
            border-radius: 12px;
        }
        .page-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(246, 200, 110, 0.96), rgba(255, 111, 97, 0.94));
            border-radius: 12px;
            border: 3px solid rgba(40, 20, 10, 0.35);
        }
        .page-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(246, 200, 110, 1), rgba(255, 111, 97, 0.98));
        }
        .highlight {
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.95), rgba(255, 140, 102, 0.95));
            color: #0b1328;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(246, 200, 110, 0.35);
            }
            .right-panel {
            position: sticky;
            top: 0px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .search-panel {
            background: linear-gradient(140deg, rgba(11, 22, 49, 0.88), rgba(7, 15, 34, 0.78));
            border-radius: 28px;
            border: 1px solid var(--glass-border);
            padding: 14px 13px 16px;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(24px);
        }
        .search-controls {
            display: flex;
                flex-direction: column;
        }
        .search-input-section textarea {
            position: relative;
            width: 100%;
            min-height: 120px;
            padding: 16px 18px;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.02));
            color: var(--ink);
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 1rem;
            letter-spacing: 0.05em;
            line-height: 1.8;
            resize: none;
            transition: transform 0.35s var(--transition), box-shadow 0.35s var(--transition), border-color 0.35s ease;
            backdrop-filter: var(--panel-blur);
            overflow: hidden;
            z-index: 0;
        }
        .search-input-section textarea::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.12), rgba(105, 227, 255, 0.08));
            opacity: 0;
            border-radius: inherit;
            transition: opacity 0.35s ease;
            pointer-events: none;
            z-index: -1;
        }
        .search-input-section textarea:hover,
        .search-input-section textarea:focus {
            border-color: rgba(246, 200, 110, 0.5);
            box-shadow: 0 12px 24px rgba(8, 14, 32, 0.4);
            transform: translateY(-1px) scale(1.01);
            outline: none;
        }
        .search-input-section textarea:hover::after,
        .search-input-section textarea:focus::after {
            opacity: 1;
        }
        .search-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(48px, 1fr));
            gap: 10px;
            padding-bottom: 8px;
        }
        .search-mode-option {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.08);
            cursor: pointer;
            transition: transform 0.35s var(--transition), box-shadow 0.35s var(--transition), border-color 0.35s ease;
            min-height: 48px;
            overflow: hidden;
        }
        .search-mode-option::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.12), rgba(105, 227, 255, 0.08));
            opacity: 0;
            border-radius: inherit;
            transition: opacity 0.35s ease;
            pointer-events: none;
        }
        .search-mode-option:hover {
            transform: translateY(-2px) scale(1.01);
            border-color: rgba(246, 200, 110, 0.5);
            box-shadow: 0 12px 24px rgba(8, 14, 32, 0.4);
        }
        .search-mode-option:hover::after {
            opacity: 1;
        }
        .search-mode-option input[type="radio"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }
        .mode-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            color: var(--ink-soft);
            transition: transform 0.35s ease, color 0.35s ease, text-shadow 0.35s ease;
            cursor: pointer;
            position: relative;
            z-index: 1;
        }
        .mode-icon svg {
            width: 22px;
            height: 22px;
            stroke-width: 1.4;
        }
        .search-mode-option input[type="radio"]:checked + .mode-icon {
            color: var(--accent-cyan);
            transform: scale(1.08);
            text-shadow: 0 0 18px rgba(105, 227, 255, 0.45);
        }
        .search-mode-option input[type="radio"]:focus-visible + .mode-icon {
            outline: 2px solid rgba(105, 227, 255, 0.7);
            outline-offset: 4px;
        }
        #searchResults {
            display: none;
            background: linear-gradient(140deg, rgba(11, 21, 42, 0.85), rgba(8, 17, 36, 0.7));
            border-radius: 22px;
            border: 1px solid var(--glass-border);
            padding: 16px;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(20px);
        }
        #searchResults.compact {
            padding: 4px;
            border-radius: 20px;
            box-shadow: 0 18px 42px rgba(7, 15, 34, 0.46);
        }
        .search-results-container {
            padding: 4px;
            
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin: 4px;
            padding-right: 4px;
        }
        #searchResults.compact .search-results-container {
            
        }
        .search-results-container::-webkit-scrollbar {
            width: 8px;
        }
        .search-results-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(130, 98, 255, 0.65), rgba(105, 227, 255, 0.55));
            border-radius: 10px;
        }
        .result-item {
            position: relative;
            padding: 18px 20px 18px 22px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.08);
            cursor: pointer;
            transition: transform 0.35s var(--transition), box-shadow 0.35s var(--transition), border-color 0.35s ease;

        }
        .result-item::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(246, 200, 110, 0.12), rgba(105, 227, 255, 0.08));
            opacity: 0;
            border-radius: 18px;
            transition: opacity 0.35s ease;
        }
        .result-item:hover {
            transform: translateY(-2px) scale(1.01);
            border-color: rgba(246, 200, 110, 0.5);
            box-shadow: 0 12px 24px rgba(8, 14, 32, 0.4);
        }
        .result-item:hover::after {
            opacity: 1;
        }
        .result-number {
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.82rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(246, 200, 110, 0.9);
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }
        .result-location {
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.82rem;
            letter-spacing: 0.1em;
            color: rgba(211, 216, 226, 0.75);
            line-height: 1.7;
            position: relative;
            z-index: 1;
        }
        .load-more-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 8px auto 8px;
            padding: 8px 16px;
            min-width: 140px;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(23, 38, 76, 0.92), rgba(13, 24, 54, 0.92));
            color: var(--ink);
            box-shadow: 0 12px 24px rgba(10, 18, 40, 0.4);
            font-size: 0.78rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
        }
        footer {
            max-width: 1280px;
            margin: 72px auto 0;
            padding: 42px 5vw 48px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--ink-dim);
            font-family: 'Source Sans 3', 'Helvetica Neue', Arial, sans-serif;
            font-size: 0.85rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            text-align: center;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.24);
            border-radius: 50%;
            border-top-color: rgba(105, 227, 255, 0.9);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes pageFlip {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        @keyframes bgPulseBefore {
            0% {
                transform: scale(0.92);
                opacity: 0;
            }
            60% {
                transform: scale(1.12);
                opacity: 0.6;
            }
            100% {
                transform: scale(1);
                opacity: 0.4;
            }
        }
        @keyframes bgPulseAfter {
            0% {
                transform: scale(1.05) translate3d(0, 0, 0);
                opacity: 0;
            }
            55% {
                transform: scale(1.18) translate3d(6%, -4%, 0);
                opacity: 0.52;
            }
            100% {
                transform: scale(1) translate3d(4%, -2%, 0);
                opacity: 0.35;
            }
        }
        @keyframes auroraBurst {
            0% {
                transform: rotate(-12deg) scale(1);
                opacity: 0;
            }
            50% {
                transform: rotate(12deg) scale(1.16);
                opacity: 0.4;
            }
            100% {
                transform: rotate(4deg) scale(1.05);
                opacity: 0.3;
            }
        }
        @keyframes gridSweep {
            0% {
                transform: rotate(-30deg) scale(0.9);
                opacity: 0;
            }
            50% {
                transform: rotate(45deg) scale(1.08);
                opacity: 0.4;
            }
            100% {
                transform: rotate(12deg) scale(1);
                opacity: 0.25;
            }
        }
        @media (max-width: 1200px) {
            .header-inner {
                flex-direction: column;
                align-items: flex-start;
            }
            .header-actions {
                margin-left: 0;
                margin-top: 18px;
            }
            .main-content {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            .right-panel {
                position: static;
            }
            .page-display {
                min-height: auto;
            }
        }
        @media (max-width: 860px) {
            header {
                padding: 36px 6vw 22px;
            }
            .nav-bar {
                grid-template-columns: 1fr;
            }
            .main-content {
                padding: 0 6vw;
            }
            .page-display {
                padding: 64px 40px 48px;
            }
            .nav-page-btn {
                top: 26px;
            }
        }
        @media (max-width: 540px) {
            .library-title {
                letter-spacing: 0.1em;
            }
            .page-display {
                padding: 56px 28px 40px;
            }
        .page-content.is-scrollable {
            max-height: none;
        }
            .search-modes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="background-layers">
        <div class="aurora aurora-1"></div>
        <div class="aurora aurora-2"></div>
        <div class="hex-grid"></div>
    </div>
    <div class="stars" id="stars"></div>
    <header class="shrunken">
        <div class="header-inner">
            <div class="header-title-block">
                <h1 class="library-title">The Library of Babel</h1>
                <p class="library-subtitle">Traverse the endless tessellation of hexagons and uncover the words that define every possible universe.</p>
                <div class="header-location" id="headerLocation"></div>
            </div>
            <div class="header-actions">
                <a href="https://github.com/theCommaLlama/libraryofbabel" target="_blank" rel="noopener" aria-label="View the project on GitHub">
                    <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                        <path d="M12 1.5a10.5 10.5 0 0 0-3.32 20.47c.52.1.7-.23.7-.5v-1.8c-2.86.62-3.45-1.38-3.45-1.38-.47-1.2-1.16-1.52-1.16-1.52-.95-.66.07-.65.07-.65 1.05.07 1.6 1.08 1.6 1.08.94 1.6 2.46 1.13 3.06.86.1-.7.37-1.14.67-1.4-2.28-.26-4.68-1.15-4.68-5.13 0-1.13.4-2.06 1.05-2.78-.1-.26-.46-1.32.1-2.76 0 0 .86-.28 2.82 1.06a9.67 9.67 0 0 1 5.14 0c1.96-1.34 2.82-1.06 2.82-1.06.56 1.44.2 2.5.1 2.76.66.72 1.05 1.65 1.05 2.78 0 4-2.4 4.86-4.69 5.12.38.33.72.98.72 1.98v2.94c0 .28.18.6.7.5A10.5 10.5 0 0 0 12 1.5Z" />
                    </svg>
                </a>
            </div>
        </div>
        <div class="nav-bar">
            <div class="nav-section">
                <label for="hexagon">Hexagon:</label>
                <input type="text" id="hexagon" placeholder="abc123xyz...">
            </div>
            <div class="nav-section">
                <label for="wall">Wall:</label>
                <input type="number" id="wall" min="1" max="4" value="1">
            </div>
            <div class="nav-section">
                <label for="shelf">Shelf:</label>
                <input type="number" id="shelf" min="1" max="5" value="1">
            </div>
            <div class="nav-section">
                <label for="volume">Vol:</label>
                <input type="number" id="volume" min="1" max="32" value="1">
            </div>
            <div class="nav-section">
                <label for="page">Page:</label>
                <input type="number" id="page" min="1" max="410" value="1">
            </div>
            <button onclick="goToLocation()">Go</button>
            <button class="secondary" onclick="browsePage()">Browse</button>
            <button class="random-btn" onclick="randomPage()">Random</button>
        </div>
    </header>
    <div class="main-content">
        <div class="left-panel">
            <div class="page-display" id="pageDisplay">
                <span role="button" class="nav-page-btn nav-prev" onclick="previousPage()" id="prevPageBtn" title="Previous Page" aria-label="Previous Page">
                    <svg class="nav-icon" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
                        <defs>
                            <linearGradient id="navBaseGlow" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="rgba(246, 200, 110, 0.65)" />
                                <stop offset="50%" stop-color="rgba(217, 175, 120, 0.6)" />
                                <stop offset="100%" stop-color="rgba(200, 150, 90, 0.65)" />
                            </linearGradient>
                            <linearGradient id="navHoverGlow" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="rgba(246, 200, 110, 0.9)" />
                                <stop offset="45%" stop-color="rgba(140, 188, 255, 0.9)" />
                                <stop offset="100%" stop-color="rgba(120, 110, 255, 0.9)" />
                            </linearGradient>
                            <linearGradient id="navPrevGlow" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="rgba(246, 200, 110, 0.8)" />
                                <stop offset="45%" stop-color="rgba(140, 188, 255, 0.85)" />
                                <stop offset="100%" stop-color="rgba(120, 110, 255, 0.85)" />
                            </linearGradient>
                        </defs>
                        <path class="hex-frame" d="M32 4 L54 16 V48 L32 60 L10 48 V16 Z" fill="rgba(255,255,255,0.14)" stroke="rgba(214, 188, 138, 0.55)" stroke-width="2" />
                        <path class="glyph" d="M36 18 L20 32 L36 46" fill="none" stroke="url(#navBaseGlow)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                        <path class="glyph" d="M24 32 H44" fill="none" stroke="url(#navBaseGlow)" stroke-width="3" stroke-linecap="round" />
                    </svg>
                </span>
                <span role="button" class="nav-page-btn nav-next" onclick="nextPage()" id="nextPageBtn" title="Next Page" aria-label="Next Page">
                    <svg class="nav-icon" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
                        <defs>
                            <linearGradient id="navNextGlow" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="rgba(120, 110, 255, 0.85)" />
                                <stop offset="55%" stop-color="rgba(140, 188, 255, 0.85)" />
                                <stop offset="100%" stop-color="rgba(246, 200, 110, 0.8)" />
                            </linearGradient>
                        </defs>
                        <path class="hex-frame" d="M32 4 L54 16 V48 L32 60 L10 48 V16 Z" fill="rgba(255,255,255,0.14)" stroke="rgba(214, 188, 138, 0.55)" stroke-width="2" />
                        <path class="glyph" d="M28 18 L44 32 L28 46" fill="none" stroke="url(#navBaseGlow)" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                        <path class="glyph" d="M40 32 H20" fill="none" stroke="url(#navBaseGlow)" stroke-width="3" stroke-linecap="round" />
                    </svg>
                </span>
                <div class="page-header">
                    <h3>Welcome To The Infinite</h3>
                    <div class="location-info">
                        Navigate to a location or search for any text to begin your journey through infinite knowledge.
                    </div>
                </div>
                <div class="page-content" id="pageContent">The Library of Babel contains every possible combination of characters. Within these walls exist all books that have been written and all books that ever could be written. Every coherent thought, every fragment of truth, every piece of nonsense—all exist somewhere in these infinite hexagons. Your name is here. The story of your life, in perfect detail, occupies a volume on some shelf. The cure for every disease, the answer to every question, the solution to every problem—all waiting to be discovered. But beware: for every truth, there are countless lies. For every masterpiece, infinite gibberish. The Library contains everything, and therefore, in a sense, contains nothing of particular value. Begin your search...</div>
            </div>
        </div>
        <div class="right-panel">
            <div class="search-panel">
                <div class="search-controls">
                    <div class="search-input-section">
                        <textarea id="searchText" placeholder="Search for any text in the Library..."></textarea>
                    </div>
                    <div class="search-modes">
                        <label class="search-mode-option">
                            <input type="radio" name="searchMode" value="exact">
                            <span class="mode-icon" aria-label="Exact Match" title="Exact Match">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="11" cy="11" r="7" />
                                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                </svg>
                            </span>
                        </label>
                        <label class="search-mode-option">
                            <input type="radio" name="searchMode" value="random" checked>
                            <span class="mode-icon" aria-label="Random Characters" title="Random Characters">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="4" />
                                    <path d="M8 8h8v8H8z" />
                                    <path d="M5 12h2" />
                                    <path d="M17 12h2" />
                                </svg>
                            </span>
                        </label>
                        <label class="search-mode-option">
                            <input type="radio" name="searchMode" value="english">
                            <span class="mode-icon" aria-label="English Words" title="English Words">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5V4.5A2.5 2.5 0 0 1 6.5 2h11A2.5 2.5 0 0 1 20 4.5v15a.5.5 0 0 1-.75.43L12 16l-7.25 3.93A.5.5 0 0 1 4 19.5Z" />
                                    <path d="M9 7h6" />
                                    <path d="M9 11h6" />
                                </svg>
                            </span>
                        </label>
                        <label class="search-mode-option">
                            <input type="radio" name="searchMode" value="title">
                            <span class="mode-icon" aria-label="Title Search" title="Title Search">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19V5a2 2 0 0 1 2-2h12" />
                                    <path d="M20 7H8" />
                                    <path d="M6 11h10" />
                                    <path d="M6 15h6" />
                                    <path d="M14 3v4" />
                                </svg>
                            </span>
                        </label>
                    </div>
                    <button onclick="searchLibrary()">Search</button>
                </div>
            </div>
        <div id="searchResults" class="compact"></div>
        </div>
    </div>
    <script>
        const CHARSET = ' abcdefghijklmnopqrstuvwxyz,.';
        const CHARS_PER_PAGE = 3200;
        const PAGES_PER_VOLUME = 410;
        const VOLUMES_PER_SHELF = 32;
        const SHELVES_PER_WALL = 5;
        const WALLS_PER_HEXAGON = 4;
        function createSeededRandom(seed) {
            return function() {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash);
        }
        function locationToSeed(hexagon, wall, shelf, volume, page) {
            const locationString = `${hexagon}:${wall}:${shelf}:${volume}:${page}`;
            return hashString(locationString);
        }
        const customPages = {};
        function storeCustomPage(hexagon, wall, shelf, volume, page, content) {
            const key = `${hexagon}:${wall}:${shelf}:${volume}:${page}`;
            customPages[key] = content;
        }
        function getCustomPage(hexagon, wall, shelf, volume, page) {
            const key = `${hexagon}:${wall}:${shelf}:${volume}:${page}`;
            return customPages[key];
        }
        function generatePage(hexagon, wall, shelf, volume, page) {
            const customContent = getCustomPage(hexagon, wall, shelf, volume, page);
            if (customContent) {
                return customContent;
            }
            const seed = locationToSeed(hexagon, wall, shelf, volume, page);
            const random = createSeededRandom(seed);
            let content = '';
            for (let i = 0; i < CHARS_PER_PAGE; i++) {
                const charIndex = Math.floor(random() * CHARSET.length);
                content += CHARSET[charIndex];
            }
            return content;
        }
        function formatPageContent(content, highlight = null) {
            let formatted = escapeHTML(content);
            if (highlight) {
                const searchText = escapeHTML(highlight.toLowerCase());
                const regex = new RegExp(escapeRegex(searchText), 'gi');
                formatted = formatted.replace(regex, (match) => `<span class="highlight">${match}</span>`);
            }
            return formatted;
        }
        function escapeHTML(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        function displayPage(hexagon, wall, shelf, volume, page, highlightText = null) {
            const content = generatePage(hexagon, wall, shelf, volume, page);
            const formattedContent = formatPageContent(content, highlightText);
            const pageContentEl = document.getElementById('pageContent');
            if (pageContentEl) {
                pageContentEl.innerHTML = formattedContent;
                pageContentEl.scrollTop = 0;
            pageContentEl.classList.add('is-scrollable');
            }
            const pageHeader = document.querySelector('.page-header');
            pageHeader.innerHTML = `
                <h3>Page ${page} of Volume ${volume}</h3>
                <div class="location-info">
                    Hexagon: ${hexagon}<br>
                    Wall: ${wall} | Shelf: ${shelf} | Volume: ${volume} | Page: ${page}
                </div>
            `;
            updateHeaderLocation(hexagon, wall, shelf, volume, page);
            const pageDisplay = document.getElementById('pageDisplay');
            pageDisplay.style.animation = 'none';
            pageDisplay.offsetHeight;
            pageDisplay.classList.add('is-animating');
            const onAnimationEnd = () => {
                pageDisplay.classList.remove('is-animating');
                pageDisplay.removeEventListener('animationend', onAnimationEnd);
            };
            pageDisplay.addEventListener('animationend', onAnimationEnd);
            updatePageNavButtons();
        }
        function goToLocation() {
            const hexagon = document.getElementById('hexagon').value.trim() || generateRandomHexagon();
            const wall = parseInt(document.getElementById('wall').value) || 1;
            const shelf = parseInt(document.getElementById('shelf').value) || 1;
            const volume = parseInt(document.getElementById('volume').value) || 1;
            const page = parseInt(document.getElementById('page').value) || 1;
            if (wall < 1 || wall > 4 || shelf < 1 || shelf > 5 || 
                volume < 1 || volume > 32 || page < 1 || page > 410) {
                return;
            }
            document.getElementById('hexagon').value = hexagon;
            displayPage(hexagon, wall, shelf, volume, page);
            updateURL();
        }
        function browsePage() {
            const hexagon = document.getElementById('hexagon').value.trim();
            const wall = parseInt(document.getElementById('wall').value);
            const shelf = parseInt(document.getElementById('shelf').value);
            const volume = parseInt(document.getElementById('volume').value);
            let page = parseInt(document.getElementById('page').value);
            page++;
            if (page > PAGES_PER_VOLUME) {
                page = 1;
            }
            document.getElementById('page').value = page;
            goToLocation();
        }
        function nextPage() {
            let page = parseInt(document.getElementById('page').value);
            if (page < PAGES_PER_VOLUME) {
                page++;
                document.getElementById('page').value = page;
                goToLocation();
            }
        }
        function previousPage() {
            let page = parseInt(document.getElementById('page').value);
            if (page > 1) {
                page--;
                document.getElementById('page').value = page;
                goToLocation();
            }
        }
        function updatePageNavButtons() {
            const page = parseInt(document.getElementById('page').value);
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
        if (prevBtn) prevBtn.classList.toggle('is-disabled', page <= 1);
        if (nextBtn) nextBtn.classList.toggle('is-disabled', page >= PAGES_PER_VOLUME);
        }
        function generateRandomHexagon() {
            const length = 12 + Math.floor(Math.random() * 8);
            let hex = '';
            const hexChars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            for (let i = 0; i < length; i++) {
                hex += hexChars[Math.floor(Math.random() * hexChars.length)];
            }
            return hex;
        }
        function randomPage() {
            const hexagon = generateRandomHexagon();
            const wall = Math.floor(Math.random() * 4) + 1;
            const shelf = Math.floor(Math.random() * 5) + 1;
            const volume = Math.floor(Math.random() * 32) + 1;
            const page = Math.floor(Math.random() * 410) + 1;
            document.getElementById('hexagon').value = hexagon;
            document.getElementById('wall').value = wall;
            document.getElementById('shelf').value = shelf;
            document.getElementById('volume').value = volume;
            document.getElementById('page').value = page;
            displayPage(hexagon, wall, shelf, volume, page);
            updateURL();
        }
        let ENGLISH_WORDS = [];

        async function loadEnglishWords() {
            try {
                const response = await fetch('words_alpha.txt');
                const text = await response.text();
                ENGLISH_WORDS = text.trim().split('\n').filter(word => word.length > 0);
                console.log(`Loaded ${ENGLISH_WORDS.length} English words`);
            } catch (error) {
                console.error('Failed to load English words:', error);
                ENGLISH_WORDS = ['the', 'and', 'for', 'are', 'but', 'not', 'you', 'all', 'can', 'had', 'her', 'was', 'one', 'our', 'out', 'day', 'get', 'has', 'him', 'his', 'how', 'its', 'may', 'new', 'now', 'old', 'see', 'two', 'way', 'who', 'boy', 'did', 'has', 'let', 'put', 'say', 'she', 'too', 'use'];
            }
        }
        let currentSearchText = '';
        let currentSearchMode = 'exact';
        let displayedResultsCount = 0;
        let searchSessionId = 0;
        const DEFAULT_INTRO_TEXT = `The Library of Babel contains every possible combination of characters. Within these walls exist all books that have been written and all books that ever could be written. Every coherent thought, every fragment of truth, every piece of nonsense—all exist somewhere in these infinite hexagons. Your name is here. The story of your life, in perfect detail, occupies a volume on some shelf. The cure for every disease, the answer to every question, the solution to every problem—all waiting to be discovered. But beware: for every truth, there are countless lies. For every masterpiece, infinite gibberish. The Library contains everything, and therefore, in a sense, contains nothing of particular value. Begin your search...`;
        const RESULTS_PER_PAGE = 10;
        function searchLibrary() {
            const searchText = document.getElementById('searchText').value.trim();
            const searchMode = document.querySelector('input[name="searchMode"]:checked').value;
            const resultsEl = document.getElementById('searchResults');
            if (!searchText) {
                currentSearchText = '';
                displayedResultsCount = 0;
                currentResultSeed = null;
                if (resultsEl) {
                    resultsEl.innerHTML = '';
                    resultsEl.style.display = 'none';
                }
                updateURL();
                return;
            }
            if (searchText.length > CHARS_PER_PAGE) {
                return;
            }
            const lowerSearch = searchText.toLowerCase();
            for (let char of lowerSearch) {
                if (!CHARSET.includes(char)) {
                    return;
                }
            }
            currentSearchText = lowerSearch;
            currentSearchMode = searchMode;
            displayedResultsCount = 0;
            searchSessionId = hashString(lowerSearch + searchMode);
            updateURL();
            if (resultsEl) {
                resultsEl.innerHTML = '';
                resultsEl.style.display = 'block';
            }
            displaySearchResults();
        }
        function generateSearchResult(index) {
            let fullText;
            const seed = searchSessionId + index;
            switch(currentSearchMode) {
                case 'exact':
                    fullText = generateWithRandomChars(currentSearchText, seed, true);
                    break;
                case 'random':
                    fullText = generateWithRandomChars(currentSearchText, seed);
                    break;
                case 'english':
                    fullText = generateWithEnglishWords(currentSearchText, seed);
                    break;
                case 'title':
                    fullText = generateAsTitle(currentSearchText, seed);
                    break;
            }
            const result = findTextInLibrary(fullText, seed);
            if (result) {
                result.displayText = fullText;
                result.originalSearch = currentSearchText;
                result.resultIndex = index;
                result.seed = seed;
            }
            return result;
        }
        function generateWithRandomChars(searchText, seed, exactMode = false) {
            const random = createSeededRandom(hashString(String(seed) + searchText));
            const maxPosition = CHARS_PER_PAGE - searchText.length;
            const position = Math.max(0, Math.floor(random() * (maxPosition + 1)));
            if (exactMode) {
                const prefixSpaces = ' '.repeat(position);
                const suffixSpaces = ' '.repeat(Math.max(0, CHARS_PER_PAGE - position - searchText.length));
                const pageContent = (prefixSpaces + searchText + suffixSpaces).slice(0, CHARS_PER_PAGE);
                const trimmedContent = pageContent.trim();
                return trimmedContent.length === searchText.length ? pageContent : searchText.padEnd(CHARS_PER_PAGE, ' ');
            }
            let result = '';
            let searchTextInserted = false;
            for (let i = 0; i < CHARS_PER_PAGE; i++) {
                if (i === position && !searchTextInserted) {
                    result += searchText;
                    searchTextInserted = true;
                    i += searchText.length - 1;
                } else if (i >= position && i < position + searchText.length && !searchTextInserted) {
                    continue;
                } else {
                    const charIndex = Math.floor(random() * CHARSET.length);
                    result += CHARSET[charIndex];
                }
            }
            if (result.length < CHARS_PER_PAGE) {
                const remaining = CHARS_PER_PAGE - result.length;
                for (let i = 0; i < remaining; i++) {
                    const charIndex = Math.floor(random() * CHARSET.length);
                    result += CHARSET[charIndex];
                }
            }
            return result.substring(0, CHARS_PER_PAGE);
        }
        function generateWithEnglishWords(searchText, seed) {
            const random = createSeededRandom(hashString(String(seed) + searchText + 'english'));
            const targetPosition = Math.floor(random() * (CHARS_PER_PAGE - searchText.length));
            let result = '';
            let searchTextInserted = false;
            while (result.length < CHARS_PER_PAGE) {
                if (!searchTextInserted && result.length >= targetPosition) {
                    if (result.length > 0 && !result.endsWith(' ')) {
                        result += ' ';
                    }
                    result += searchText;
                    searchTextInserted = true;
                    if (result.length < CHARS_PER_PAGE) {
                        result += ' ';
                    }
                } else {
                    const word = ENGLISH_WORDS[Math.floor(random() * ENGLISH_WORDS.length)];
                    if (result.length + word.length + 1 <= CHARS_PER_PAGE) {
                        if (result.length > 0) result += ' ';
                        result += word;
                    } else {
                        result += ' '.repeat(CHARS_PER_PAGE - result.length);
                    }
                }
            }
            if (!searchTextInserted) {
                result = searchText + ' ' + result.substring(searchText.length + 1);
            }
            return result.substring(0, CHARS_PER_PAGE);
        }
        function generateAsTitle(searchText, seed) {
            const random = createSeededRandom(hashString(String(seed) + searchText + 'title'));
            const charsPerLine = 80;
            let title = searchText;
            while (title.length < charsPerLine) {
                title += ' ';
            }
            title = title.substring(0, charsPerLine);
            let result = title;
            for (let i = charsPerLine; i < CHARS_PER_PAGE; i++) {
                const charIndex = Math.floor(random() * CHARSET.length);
                result += CHARSET[charIndex];
            }
            return result;
        }
        function displaySearchResults() {
            if (!currentSearchText) return;
            const container = document.getElementById('searchResults');
            if (!container) return;
            container.style.display = 'block';
            if (displayedResultsCount === 0) {
                container.innerHTML = '<div class="search-results-container" id="resultsContainer"></div>';
            }
            const resultsContainer = document.getElementById('resultsContainer');
            const endIndex = displayedResultsCount + RESULTS_PER_PAGE;
            for (let i = displayedResultsCount; i < endIndex; i++) {
                const result = generateSearchResult(i);
                if (!result) continue;
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-item';
                resultDiv.onclick = () => goToResult(result);
                resultDiv.innerHTML = `
                    <div class="result-number">Result ${i + 1}</div>
                    <div class="result-location">
                        Hexagon: ${result.hexagon}<br>
                        Wall: ${result.wall} | Shelf: ${result.shelf} | Volume: ${result.volume} | Page: ${result.page}
                    </div>
                `;
                resultsContainer.appendChild(resultDiv);
            }
            displayedResultsCount = endIndex;
            const existingBtn = document.getElementById('loadMoreBtn');
            if (existingBtn) {
                existingBtn.remove();
            }
            const loadMoreBtn = document.createElement('button');
            loadMoreBtn.id = 'loadMoreBtn';
            loadMoreBtn.className = 'load-more-btn';
            loadMoreBtn.textContent = 'Load More Results';
            loadMoreBtn.onclick = displaySearchResults;
            container.appendChild(loadMoreBtn);
        }
        function goToResult(result) {
            document.getElementById('hexagon').value = result.hexagon;
            document.getElementById('wall').value = result.wall;
            document.getElementById('shelf').value = result.shelf;
            document.getElementById('volume').value = result.volume;
            document.getElementById('page').value = result.page;
            currentResultSeed = result.seed;
            displayPage(result.hexagon, result.wall, result.shelf, result.volume, result.page, result.originalSearch);
            updateURL();
        }
        let currentResultSeed = null;
        function formatHeaderLocation(hexagon, wall, shelf, volume, page) {
            const segments = [
                hexagon ? `Hex ${hexagon}` : null,
                wall ? `Wall ${wall}` : null,
                shelf ? `Shelf ${shelf}` : null,
                volume ? `Vol ${volume}` : null,
                page ? `Page ${page}` : null
            ].filter(Boolean);
            return segments.join(' • ');
        }
        function updateHeaderLocation(hexagon, wall, shelf, volume, page) {
            const headerLocationEl = document.getElementById('headerLocation');
            if (!headerLocationEl) return;
            const formattedLocation = formatHeaderLocation(hexagon, wall, shelf, volume, page);
            headerLocationEl.textContent = formattedLocation;
            headerLocationEl.classList.toggle('is-visible', formattedLocation.length > 0);
        }
        function updateURL() {
            const params = new URLSearchParams();
            const hexagon = document.getElementById('hexagon').value.trim();
            const wall = document.getElementById('wall').value;
            const shelf = document.getElementById('shelf').value;
            const volume = document.getElementById('volume').value;
            const page = document.getElementById('page').value;
            if (hexagon) params.set('hex', hexagon);
            if (wall) params.set('wall', wall);
            if (shelf) params.set('shelf', shelf);
            if (volume) params.set('vol', volume);
            if (page) params.set('page', page);
            if (currentSearchText) {
                params.set('search', currentSearchText);
                params.set('mode', currentSearchMode);
                if (currentResultSeed !== null) {
                    params.set('seed', currentResultSeed);
                }
            }
            const newURL = window.location.pathname + '?' + params.toString();
            window.history.pushState({}, '', newURL);
        }
        async function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            const hexagon = params.get('hex');
            const wall = params.get('wall');
            const shelf = params.get('shelf');
            const volume = params.get('vol');
            const page = params.get('page');
            const search = params.get('search');
            const mode = params.get('mode');
            const urlSeed = params.get('seed');
            if (hexagon) document.getElementById('hexagon').value = hexagon;
            if (wall) document.getElementById('wall').value = wall;
            if (shelf) document.getElementById('shelf').value = shelf;
            if (volume) document.getElementById('volume').value = volume;
            if (page) document.getElementById('page').value = page;
            let highlightText = null;
            if (search) {
                document.getElementById('searchText').value = search;
                currentSearchText = search.toLowerCase();
                currentSearchMode = mode || 'exact';
                highlightText = search.toLowerCase();
                const modeRadio = document.querySelector(`input[name="searchMode"][value="${currentSearchMode}"]`);
                if (modeRadio) modeRadio.checked = true;
                searchSessionId = hashString(currentSearchText + currentSearchMode);
                if (currentSearchMode === 'english' && ENGLISH_WORDS.length === 0) {
                    await loadEnglishWords();
                }
                displayedResultsCount = 0;
                const resultsEl = document.getElementById('searchResults');
                if (resultsEl) {
                    resultsEl.innerHTML = '';
                    resultsEl.style.display = 'block';
                }
                displaySearchResults();
            }
            if (hexagon && wall && shelf && volume && page) {
                const h = hexagon;
                const w = parseInt(wall);
                const s = parseInt(shelf);
                const v = parseInt(volume);
                const p = parseInt(page);
                if (search && mode) {
                    let pageContent;
                    const searchLower = search.toLowerCase();
                    const seed = urlSeed ? parseFloat(urlSeed) : hashString(h + ':' + w + ':' + s + ':' + v + ':' + p);
                    currentResultSeed = seed;
                    switch(mode) {
                        case 'exact':
                            pageContent = generateWithRandomChars(searchLower, seed, true);
                            break;
                        case 'random':
                            pageContent = generateWithRandomChars(searchLower, seed);
                            break;
                        case 'english':
                            pageContent = generateWithEnglishWords(searchLower, seed);
                            break;
                        case 'title':
                            pageContent = generateAsTitle(searchLower, seed);
                            break;
                        default:
                            pageContent = generateWithRandomChars(searchLower, seed);
                    }
                    storeCustomPage(h, w, s, v, p, pageContent);
                }
                displayPage(h, w, s, v, p, highlightText);
        } else if (hexagon || wall || shelf || volume || page) {
                const h = document.getElementById('hexagon').value || generateRandomHexagon();
                const w = parseInt(document.getElementById('wall').value) || 1;
                const s = parseInt(document.getElementById('shelf').value) || 1;
                const v = parseInt(document.getElementById('volume').value) || 1;
                const p = parseInt(document.getElementById('page').value) || 1;
                document.getElementById('hexagon').value = h;
                displayPage(h, w, s, v, p, highlightText);
        }
        const headerHex = document.getElementById('hexagon').value.trim();
        const hasUrlHex = new URLSearchParams(window.location.search).has('hex');
        if (hasUrlHex && headerHex) {
            updateHeaderLocation(
                headerHex,
                document.getElementById('wall').value,
                document.getElementById('shelf').value,
                document.getElementById('volume').value,
                document.getElementById('page').value
            );
        } else {
            updateHeaderLocation('', '', '', '', '');
        }
        }
        function findTextInLibrary(fullPageContent, seed = 0) {
            const hexagon = hashString(fullPageContent + seed).toString(36);
            const searchHash = hashString(fullPageContent + seed);
            const wall = (searchHash % 4) + 1;
            const shelf = ((searchHash >> 2) % 5) + 1;
            const volume = ((searchHash >> 4) % 32) + 1;
            const page = ((searchHash >> 8) % PAGES_PER_VOLUME) + 1;
            storeCustomPage(hexagon, wall, shelf, volume, page, fullPageContent);
            return {
                hexagon,
                wall,
                shelf,
                volume,
                page
            };
        }
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numberOfStars = 200;
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.opacity = Math.random() * 0.7 + 0.3;
                starsContainer.appendChild(star);
            }
        }
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousPage();
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                nextPage();
            }
        });
        async function initializeApp() {
            createStars();
            await loadEnglishWords();
            await loadFromURL();
            const params = new URLSearchParams(window.location.search);
            const hasUrlHex = params.has('hex');
            const headerHex = document.getElementById('hexagon').value.trim();
            if (hasUrlHex && headerHex) {
                updateHeaderLocation(
                    headerHex,
                    document.getElementById('wall').value,
                    document.getElementById('shelf').value,
                    document.getElementById('volume').value,
                    document.getElementById('page').value
                );
            } else {
                updateHeaderLocation('', '', '', '', '');
            }
            const libraryTitle = document.querySelector('.library-title');
            if (libraryTitle) {
                libraryTitle.addEventListener('click', () => {
                    document.getElementById('hexagon').value = '';
                    document.getElementById('wall').value = '';
                    document.getElementById('shelf').value = '';
                    document.getElementById('volume').value = '';
                    document.getElementById('page').value = '';
                    updateHeaderLocation('', '', '', '', '');
                    const pageContentEl = document.getElementById('pageContent');
                    if (pageContentEl) {
                        pageContentEl.textContent = DEFAULT_INTRO_TEXT;
                        pageContentEl.scrollTop = 0;
                    }
                    const pageDisplayEl = document.getElementById('pageDisplay');
                    if (pageDisplayEl) {
                        pageDisplayEl.scrollTop = 0;
                    }
                    window.history.replaceState({}, '', window.location.pathname);
                document.getElementById('searchText').value = '';
                currentSearchText = '';
                currentSearchMode = 'random';
                const randomRadio = document.querySelector('input[name="searchMode"][value="random"]');
                if (randomRadio) {
                    randomRadio.checked = true;
                }
                const resultsEl = document.getElementById('searchResults');
                if (resultsEl) {
                    resultsEl.innerHTML = '';
                    resultsEl.style.display = 'none';
                }
                });
            }
        }

        initializeApp();
    </script>
</body>
</html>
